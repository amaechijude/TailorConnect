{% extends 'base.html' %}
{% block title %} Make Payment {% endblock %}
{% block content %}
{% load static %}
<link rel="stylesheet" href="{% static 'css/index.css' %}">
<script src="https://js.paystack.co/v2/inline.js"></script>
<!-- Sidebar -->
<div class="sidebar">
	<a href="{% url 'index' %}">Home</a>
	{% if request.user.is_authenticated %}
	<!-- <a href="{% url 'wishlist' %}">WishList<span id="wishcount" class="count"> {{ request.user.wishlist_count }}</span></a> -->
	<a href="{% url 'profile' %}">Profile</a>
	<a href="{% url 'logout_user' %}">Logout</a>
	{% else %}
	<a href="{% url 'login_user' %}">Login</a>
	<a href="{% url 'register' %}">Register</a>
	{% endif %}
</div>

<!-- Main Content -->
<div class="main-content" style="margin-top: -4%;">
	<br><br>
	<h2 class="mb-4">Make Payments</h2> <br>
	<div class="container">
		<div class="row g-3">
			<div class="col-md-4 d-flex">
				<div class="product-item">
					<img src="{{ style.images.url }}" class="product-image">
					<h3 class="product-title">{{ order.title }}</h3>
					<p class="product-description">{{ order.description }} </p>

				</div>
			</div>
			<div>
				You are about to pay #<strong>{{ order.asking_price }}</strong> for the above item. <br><br>
				<form action="{% url 'pay' %}" method="post" id="payForm">
					{% csrf_token %}
					<input type="hidden" name="orderId" value="{{ order.id }}">
					<button type="submit" class=" btn btn-outline-success">Pay</button>
				</form>
			</div>
		</div>
	</div>
</div>
<script>
	function ResumeTransaction(a_code) {
		const popup = new PaystackPop();
		popup.resumeTransaction(access_code);
	}

	function VerifyPayment(r_code) {
		windows.location.href = `/payment/verify/${r_code}`;
	}


	const form = document.getElementById("payForm");
	form.addEventListener("submit", async (event) => {
		event.preventDefault();
		const formData = new FormData(form);

		const response = await fetch('/payment/pay', {
			method: 'POST',
			body: formData
		});
		//const data = await response.json();
		//const access_code = data.access_code; //get access code
		//const ref = data.ref;

		// Paystack opup
		const popup = new PaystackPop();
		popup.resumeTransaction(access_code);

	});
</script>
{% endblock %}
